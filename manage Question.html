<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questions manager</title>
    <style>
        /* Clean Modern Theme */
/* Simple, Clean UI */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: Arial, Helvetica, sans-serif;
}

body {
    background-image: url("images/background.jpeg");
    background-size: 100vw 160vh;
    background-repeat: no-repeat;
    background-position: center;
    color: white;
    text-align: center;
    padding: 25px 15px 90px;
}

h2 {
    font-size: 2rem;
    margin-bottom: 10px;
    font-weight: 700;
}

p {
    font-size: 1.05rem;
    max-width: 650px;
    margin: 0 auto 25px;
    color: #555;
}

/* Container */
.main-container {
    max-width: 750px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* Cards */
.fieldDiv {
    background: white;
    padding: 18px 50px 18px 18px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 1.1rem;
    text-align: left;
    cursor: pointer;
    position: relative;
    transition: background 0.15s;
    margin: 5px;    
}

.fieldDiv:hover {
    background: #eaeaea;
}

/* Completed state */
.fieldDiv[style*="background: #71ff6a"] {
    background: #dfffe0 !important;
    border-color: #7cd67f;
    color: #239c2c;
    cursor: default;
}

/* Show more button */
.showMore {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: #eee;
    padding: 4px 9px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1.1rem;
}

.showMore:hover {
    background: #ddd;
}

/* Score details */
.main-container > .fieldDiv > div[class^="item-"] {
    margin-top: 10px;
    padding: 12px;
    background: #fafafa;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    font-size: 0.95rem;
}

.main-container > .fieldDiv > div[class^="item-"] h4 {
    margin-bottom: 10px;
    color: #444;
}

.main-container > .fieldDiv > div[class^="item-"] ol {
    padding-left: 18px;
    color: #444;
}

/* Empty state */
.nothing {
    display: none;
    max-width: 450px;
    margin: 40px auto;
    padding: 25px;
    border: 1px dashed #aaa;
    border-radius: 8px;
    background: white;
    color: #666;
    font-size: 1.1rem;
}

/* Next button */
#goNext {
    position: fixed;
    bottom: 25px;
    right: 25px;
    width: 130px;
    height: 48px;
    border: none;
    border-radius: 8px;
    background: #00b894;
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
}

#goNext:disabled {
    background: #9e9e9e;
    cursor: default;
}

/* Mobile responsive */
@media (max-width: 480px) {
    h2 {
        font-size: 1.6rem;
    }
    .fieldDiv {
        padding: 16px 45px 16px 14px;
        font-size: 1rem;
    }
    #goNext {
        width: 120px;
        height: 45px;
        font-size: 1rem;
    }
}

/* Special styling based on item type */
.fieldDiv[data-type="html"] {
    border-left: 5px solid #e74c3c;   /* red */
}

.fieldDiv[data-type="css"] {
    border-left: 5px solid #3498db;   /* blue */
}

.fieldDiv[data-type="js"] {
    border-left: 5px solid #f1c40f;   /* yellow */
}

/* Subtle color for text */
.fieldDiv[data-type="html"] span.tag {
    color: #c0392b;
}

.fieldDiv[data-type="css"] span.tag {
    color: #2e86c1;
}

.fieldDiv[data-type="js"] span.tag {
    color: #b7950b;
}
p.subtitle {
    font-size: 1.12rem;
    max-width: 720px;
    margin: 0 auto 30px;
    color: white;    
    padding: 12px 18px;
    background: #ffffff;
    border-radius: 8px;
    background: transparent;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
    </style>  
</head>
<body>
    <h2>Welcome to this page</h2>
   <p class="subtitle">Choose a topic you want to explore. Each one has questions waiting for you.</p>
    <div class="main-container"></div>
    <div class="nothing">There is nothing in here</div>
    <button id="goNext">Next</button>
    <script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabaseUrl = "https://jurgrpqwyilfdpzbzfrd.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1cmdycHF3eWlsZmRwemJ6ZnJkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5NDM3NTYsImV4cCI6MjA3MTUxOTc1Nn0.1E-1XaNMTuHGUpgVknyWxiiYXArdDCR9yXa8QzOms5E";
const supabase = createClient(supabaseUrl, supabaseKey);

let userId = localStorage.getItem("userId");                                

        const GoNext = document.getElementById("goNext");
        GoNext.disabled = true;
        const MC = document.querySelector(".main-container");  
        const NC = document.querySelector(".nothing");
        let WhichDone = JSON.parse(localStorage.getItem("WhichDone")) || {};
        const interestsArr = JSON.parse(localStorage.getItem("interests")) || [];
        const Score = JSON.parse(localStorage.getItem("score")) || {};
        let Scores = JSON.parse(localStorage.getItem("scores")) || [];
        if (!Array.isArray(Scores)) Scores = [];

        function show() {
            if (interestsArr.length < 1) return showNothing();

            NC.style.display = "none";
            MC.style.display = "block";

            MC.innerHTML = ""; // clear previous

            interestsArr.forEach((interest, i) => {
                let div = document.createElement("div");
                div.classList.add("fieldDiv");
                // Detect type (simple keywords)
let type = "other";
if (interest.toLowerCase().includes("html")) type = "html";
if (interest.toLowerCase().includes("css")) type = "css";
if (interest.toLowerCase().includes("js") || interest.toLowerCase().includes("javascript")) type = "js";

div.setAttribute("data-type", type);

// Add colored title
div.innerHTML = `<span class="tag">${interest}</span>`;
                MC.appendChild(div);                

                // Show More button
                let button = document.createElement("button");
                button.classList.add("showMore");
                button.textContent = "ðŸ”»";
                button.dataset.showed = "false";
                div.appendChild(button);

                // Click on main div
                   const clickHandler = () => handleDivClick(interest);
                div.addEventListener("click", clickHandler);

                if (WhichDone[interest]){
                   div.style.background = "#71ff6a";
                   div.removeEventListener("click", clickHandler);
                }

                // Click on show more button
                button.addEventListener("click", (event) => {
                    event.stopPropagation();

                    let divChild = div.querySelector(`.item-${i}`);

                    if (button.dataset.showed === "true") {
                        if (divChild) divChild.remove();
                        button.dataset.showed = "false";
                        button.textContent = "ðŸ”»";
                    } else {
                        button.dataset.showed = "true";
                        button.textContent = "ðŸ”º";

                        const newDiv = document.createElement("div");
                        newDiv.classList.add(`item-${i}`);
                        newDiv.style.marginTop = "5px";

                        let ThisObject = Scores.find(item => item.field === interest);

                        if (!ThisObject) {
                            newDiv.textContent = "Nothing in here";
                        } else {
                            let html = `
                                <h4>Score Details:</h4>
                                <ol>
                            `;
                            for (const key in ThisObject) {
                                html += `<li><strong>${key}:</strong> ${ThisObject[key]}</li>`;
                            }
                            html += `</ol>`;
                            newDiv.innerHTML = html;
                        }

                        div.appendChild(newDiv);
                    }
                });
            });
         }
         
       function handleDivClick(interest) {
            localStorage.setItem("field", interest);
            window.location.href = "./Question/first.html";
        }

        function showNothing() {
            NC.style.display = "block";
            MC.style.display = "none";    
        }

        async function finalFunction() {
		   		const { data, error } = await supabase
				  .from('Users basic information')
				  .update({ "Score": JSON.stringify(Scores)}) // only update this column
				  .eq('user_id', userId); // condition for which row(s) to update   
				  
				  localStorage.setItem("allDone", true);
				  
				  window.location.href = "index.html";        
        }

        function checkAllDone() {
            for (const key in WhichDone) {
                if (!(WhichDone[key]))  return;                   
            }
            GoNext.disabled = false;
            GoNext.style.background = "cyan";
            GoNext.addEventListener("click", finalFunction);
        }

        function updateScores() {
            if (Scores.length < 1) {
                Scores.push(Score);
                localStorage.setItem("scores", JSON.stringify(Scores));
                return;
            }
            let exists = Scores.some(s => s.field === Score.field);	
            if (!exists) Scores.push(Score);
            localStorage.setItem("scores", JSON.stringify(Scores));
        }

        function generateWhichDone() {
            for (const key of interestsArr) {
                if (!(key in WhichDone)) WhichDone[key] = false;
            }
            localStorage.setItem("WhichDone", JSON.stringify(WhichDone));
        }

        if (Object.keys(WhichDone).length < interestsArr.length) generateWhichDone();
        if (Object.keys(Score).length > 0) updateScores();
        if (interestsArr.length > 0) show();
        else showNothing();
        
        checkAllDone();
    </script>
</body>
</html>
